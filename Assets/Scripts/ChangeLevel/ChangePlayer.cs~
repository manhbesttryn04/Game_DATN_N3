using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class ChangePlayer : MonoBehaviour {

	public GameObject KnightCharater;
	public GameObject DragonCharater;
	public KeyCode KeyChange;

	public float timeChange = 10f;
	public GameObject AnimationChange;
	public float timeCancel = 0.8f;

	private float nextTimeChange = 0f;
	public bool IsKnight = true;
	private bool Press = false;

	public bool GetKnight(){
		return IsKnight;
	}

	private void CheckActiveknightCharacter(){
		IsKnight = PlayerManager.LoadChangePlayer ();
		SetChange (IsKnight);
	}

	// Use this for initialization
	private void Start () {
		nextTimeChange = 0f;
		CheckActiveknightCharacter ();
	}

	// Thuc hien thay doi animation theo gameobject
	public Animator SetAnimationByGameObject(){
		if (this.GetKnight ()) {
			return KnightCharater.GetComponent <Animator> ();
		} else {
			return DragonCharater.GetComponent <Animator>();
		}
	}

	/// <summary>
	/// Sets the change.
	/// </summary>
	/// <param name="value">If set to <c>true</c> value.</param>
	private void SetChange(bool value){
		KnightCharater.SetActive (value);
		DragonCharater.SetActive (!value);
		IsKnight = value; // Gan lai doi tuong da thay doi
		// Luu lai thong tin chuyen doi
		PlayerManager.SaveChangePlayer (IsKnight);
		PlayerMoving.anim = SetAnimationByGameObject ();
	}

	private void HandlingChangePlayer ()
	{
		// Kiem tra nhan nut
		if (Input.GetKey (KeyChange) && !Press) {
			if (nextTimeChange < Time.time) {
				Press = true;
			nextTimeChange = timeChange + Time.time;
			}
		}
		// Thuc hien sau khi nhan nut
		if (Press && PlayerMoving.grounded) {
			AnimationChange.SetActive (true); // Hien hieu ung
			PlayerMoving.Move = false; // Khong dc di chuyen

			Invoke ("InvokeCancelAnimation",timeCancel);
		}
		//Invoke ("InvokeChange", 0.5f);
	}

	private void InvokeCancelAnimation(){
		Press = false;
		PlayerMoving.Move = true;
		// Huy hieu ung bien hinh
		AnimationChange.SetActive (false);
		// Thuc hien hien cac doi tuong can thiet
		if (!IsKnight) {
			SetChange (true);
			// true: hien hiep si, an rong
		}
		else {
			SetChange (false);
			// false: hien rong, an hiep si
		}
		CancelInvoke ("InvokeCancelAnimation");
	}

	// Update is called once per frame
	private void Update () {
		HandlingChangePlayer ();
	}

	private void InvokeChange(){
		if (!Input.GetKey (KeyChange)) {
			Press = true;
		}
	}
}
